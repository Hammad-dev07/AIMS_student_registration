<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="images/logo.png" type="image/png">
    <title>AIMS Student Registration Portal</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-blue: #0066cc;
            --secondary-blue: #004499;
            --light-blue: #3399ff;
            --dark-blue: #002266;
            --accent-blue: #00aaff;
            --primary-gradient: linear-gradient(135deg, #0066cc 0%, #004499 50%, #00aaff 100%);
            --glass-bg: rgba(51, 153, 255, 0.1);
            --glass-border: rgba(51, 153, 255, 0.2);
            --text-primary: #1a1a2e;
            --text-secondary: #16213e;
            --text-light: #ffffff;
            --shadow-lg: 0 25px 50px -12px rgba(0, 102, 204, 0.25);
            --shadow-mathematical: 0 15px 35px rgba(0, 68, 153, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--primary-gradient);
            min-height: 100vh;
            overflow-x: hidden;
            line-height: 1.6;
            position: relative;
        }

        

        /* Animated Mathematical Background */
.bg-animation {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -2;
    background: var(--primary-gradient);
}

.bg-animation::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: 
        radial-gradient(circle at 20% 50%, rgba(51, 153, 255, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(0, 102, 204, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 40% 80%, rgba(0, 170, 255, 0.1) 0%, transparent 50%);
    animation: backgroundPulse 6s ease-in-out infinite alternate;
}

@keyframes backgroundPulse {
    0% { opacity: 0.5; transform: scale(1); }
    100% { opacity: 0.8; transform: scale(1.05); }
}

/* Mathematical Symbols Animation */
.math-symbols-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
    pointer-events: none;
    overflow: hidden;
}

.math-symbol-animated {
    position: absolute;
    font-size: 2rem;
    color: rgba(51, 153, 255, 0.3);
    font-weight: bold;
    animation: mathFloat 8s linear infinite;
}

@keyframes mathFloat {
    0% {
        transform: translateY(100vh) rotate(0deg);
        opacity: 0;
    }
    10% {
        opacity: 1;
    }
    90% {
        opacity: 1;
    }
    100% {
        transform: translateY(-100px) rotate(360deg);
        opacity: 0;
    }
}

/* Floating Mathematical Elements */
.floating-elements {
    position: fixed;
    width: 100%;
    height: 100%;
    z-index: -1;
    pointer-events: none;
}

.floating-element {
    position: absolute;
    background: var(--glass-bg);
    backdrop-filter: blur(10px);
    border: 1px solid var(--glass-border);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    animation: floatMath 12s ease-in-out infinite;
    color: var(--light-blue);
    font-weight: bold;
    font-size: 1.5rem;
}

.floating-element:nth-child(1) {
    width: 80px;
    height: 80px;
    top: 10%;
    left: 5%;
    animation-delay: 0s;
}

.floating-element:nth-child(2) {
    width: 60px;
    height: 60px;
    top: 60%;
    right: 10%;
    animation-delay: 2s;
}

.floating-element:nth-child(3) {
    width: 100px;
    height: 100px;
    bottom: 20%;
    left: 15%;
    animation-delay: 4s;
}

.floating-element:nth-child(4) {
    width: 70px;
    height: 70px;
    top: 30%;
    right: 20%;
    animation-delay: 1s;
}

.floating-element:nth-child(5) {
    width: 90px;
    height: 90px;
    top: 50%;
    left: 50%;
    animation-delay: 3s;
}

.floating-element:nth-child(6) {
    width: 75px;
    height: 75px;
    bottom: 40%;
    right: 30%;
    animation-delay: 5s;
}

.floating-element:nth-child(7) {
    width: 85px;
    height: 85px;
    top: 80%;
    left: 30%;
    animation-delay: 2.5s;
}

.floating-element:nth-child(8) {
    width: 65px;
    height: 65px;
    top: 15%;
    left: 70%;
    animation-delay: 4.5s;
}

@keyframes floatMath {
    0%, 100% { 
        transform: translateY(0px) rotate(0deg) scale(1); 
        opacity: 0.6;
    }
    25% { 
        transform: translateY(-20px) rotate(90deg) scale(1.1); 
        opacity: 0.8;
    }
    50% { 
        transform: translateY(-40px) rotate(180deg) scale(1); 
        opacity: 1;
    }
    75% { 
        transform: translateY(-20px) rotate(270deg) scale(0.9); 
        opacity: 0.8;
    }
}

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Background animations */
        .bg-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            background: var(--primary-gradient);
        }

        .bg-animation::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(51, 153, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(0, 102, 204, 0.1) 0%, transparent 50%);
            animation: backgroundPulse 6s ease-in-out infinite alternate;
        }

        @keyframes backgroundPulse {
            0% { opacity: 0.5; }
            100% { opacity: 0.8; }
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 40px;
            animation: slideDown 1s ease-out;
        }

        .logo-container {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
        }

        .custom-logo {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 2px solid var(--glass-border);
            border-radius: 25px;
            padding: 25px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-mathematical);
            transition: all 0.4s ease;
            text-align: center;
        }

        .logo-subtitle {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.8);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .tagline {
            font-size: 1.3rem;
            opacity: 0.9;
            font-weight: 400;
            max-width: 700px;
            margin: 0 auto;
            line-height: 1.5;
            color: var(--text-light);
        }

        /* Stats section */
        .stats-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 50px;
            animation: fadeInUp 1s ease-out 0.2s both;
        }

        .stat-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 25px;
            padding: 35px 25px;
            text-align: center;
            color: var(--text-light);
            box-shadow: var(--shadow-mathematical);
            transition: all 0.4s ease;
        }

        .stat-card:hover {
            transform: translateY(-10px) scale(1.03);
            box-shadow: var(--shadow-lg);
        }

        .stat-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            display: block;
        }

        .stat-number {
            font-size: 3.5rem;
            font-weight: 800;
            margin-bottom: 10px;
            line-height: 1;
            color: var(--accent-blue);
        }

        .stat-label {
            font-size: 1.1rem;
            opacity: 0.9;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Form container - CENTERED AND LIMITED WIDTH */
        .form-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(25px);
            border: 1px solid rgba(51, 153, 255, 0.2);
            border-radius: 35px;
            padding: 40px;
            box-shadow: var(--shadow-lg);
            animation: slideUp 1s ease-out 0.4s both;
            position: relative;
            overflow: hidden;
            max-width: 900px;
            margin: 0 auto;
        }

        .form-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: var(--primary-gradient);
            border-radius: 35px 35px 0 0;
        }

        .form-header {
            text-align: center;
            margin-bottom: 45px;
        }

        .form-icon {
            font-size: 4rem;
            color: var(--primary-blue);
            margin-bottom: 20px;
            font-weight: bold;
        }

        .form-title {
            color: var(--text-primary);
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 15px;
        }

        .form-subtitle {
            color: var(--text-secondary);
            font-size: 1.2rem;
            font-weight: 400;
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.6;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-bottom: 35px;
        }

        .form-group {
            position: relative;
        }

        .form-group label {
            display: flex;
            align-items: center;
            color: var(--text-primary);
            font-weight: 600;
            margin-bottom: 12px;
            font-size: 1rem;
            letter-spacing: 0.3px;
        }

        .required {
            color: #dc2626;
            margin-left: 4px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 20px;
            border: 2px solid #e0e7ff;
            border-radius: 16px;
            font-size: 1rem;
            font-family: inherit;
            transition: all 0.3s ease;
            background: white;
            font-weight: 400;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(0, 102, 204, 0.1);
            transform: translateY(-3px);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 130px;
            line-height: 1.6;
        }

        .form-group.full-width {
            grid-column: 1 / -1;
        }

        .submit-section {
            text-align: center;
            margin-top: 40px;
        }

        .submit-btn {
            background: var(--primary-gradient);
            color: white;
            border: none;
            padding: 22px 70px;
            border-radius: 18px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.4s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
            min-width: 280px;
            box-shadow: var(--shadow-mathematical);
        }

        .submit-btn:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: var(--shadow-lg);
        }

        /* Modal styles - COMPLETELY REWRITTEN */
        .modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 34, 102, 0.8);
            backdrop-filter: blur(10px);
        }

        .modal.show {
            display: block;
        }

        .modal-content {
            background-color: #fefefe;
            margin: 1% auto;
            padding: 40px;
            border-radius: 30px;
            width: 90%;
            max-width: 600px;
            position: relative;
            animation: modalSlideIn 0.6s ease-out;
            box-shadow: var(--shadow-lg);
            text-align: center;
        }

        .modal-close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            position: absolute;
            right: 20px;
            top: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.05);
        }

        .modal-close:hover {
            color: black;
            background: rgba(0, 0, 0, 0.1);
        }

        .modal-logo {
            width: 80px;
            height: 80px;
            margin: 0 auto 25px auto;
            display: block;
            object-fit: contain;
        }

        .modal h2 {
            color: var(--text-primary);
            margin-bottom: 20px;
            font-size: 2.5rem;
            font-weight: 700;
        }

        .modal p {
            color: var(--text-secondary);
            font-size: 1.2rem;
            line-height: 1.7;
            margin-bottom: 20px;
        }

        .modal-equation {
            background: rgba(0, 102, 204, 0.1);
            padding: 20px;
            border-radius: 15px;
            margin: 25px 0;
            border: 2px solid rgba(0, 102, 204, 0.2);
        }

        .modal-equation span {
            font-family: 'Courier New', monospace;
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--primary-blue);
        }

        .modal-btn {
            background: var(--primary-gradient);
            color: white;
            border: none;
            padding: 18px 45px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .modal-btn:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-mathematical);
        }

        .modal-math-symbol {
            font-size: 5rem;
            color: #10b981;
            margin-bottom: 25px;
            display: block;
            font-weight: bold;
        }

        .modal-equation.success {
            background: rgba(16, 185, 129, 0.1);
            border-color: rgba(16, 185, 129, 0.2);
        }

        .modal-equation.success span {
            color: #10b981;
        }

        /* Loading state */
        .submit-btn.loading {
            color: transparent;
        }

        .submit-btn.loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 25px;
            height: 25px;
            margin: -12.5px 0 0 -12.5px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-60px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(60px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(40px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes modalSlideIn {
            from { 
                opacity: 0; 
                transform: scale(0.7) translateY(-50px);
            }
            to { 
                opacity: 1; 
                transform: scale(1) translateY(0);
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .form-grid { 
                grid-template-columns: 1fr; 
                gap: 20px; 
            }
            .stats-section {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
            .modal-content { 
                margin: 10% auto; 
                padding: 30px 20px; 
            }
            .form-title { font-size: 2.5rem; }
        }

        @media (max-width: 480px) {
            .stats-section { 
                grid-template-columns: 1fr; 
            }
            .submit-btn { 
                width: 100%;
                padding: 20px;
            }
            .form-container {
                padding: 25px 15px;
            }
        }
    </style>
</head>
<body>
    <!-- Animated Math Symbols Background -->
    <div class="math-symbols-container" id="mathSymbols"></div>
    
    <!-- Blue Gradient Background -->
    <div class="bg-animation"></div>
    
    <!-- Floating Mathematical Elements -->
    <div class="floating-elements">
        <div class="floating-element math-element">∑</div>
        <div class="floating-element math-element">∫</div>
        <div class="floating-element math-element">π</div>
        <div class="floating-element math-element">∂</div>
        <div class="floating-element math-element">∞</div>
        <div class="floating-element math-element">√</div>
        <div class="floating-element math-element">∆</div>
        <div class="floating-element math-element">Ω</div>
    </div>

    <div class="container">
        <header class="header">
            <div class="logo-container">
                <div class="custom-logo">
                    <img src="images/logo.png" alt="AIMS Logo" style="width:80px; height:80px; object-fit:contain; margin-bottom:10px;">
                    <div class="logo-subtitle">Artificial Intelligence & Mathematics Society</div>
                </div>
            </div>
            <p class="tagline">Empowering the next generation of innovators through Artificial Intelligence and Mathematical Excellence</p>
        </header>

        <section class="stats-section">
            <div class="stat-card">
                <div class="stat-icon">👥</div>
                <div class="stat-number" id="totalStudents">11</div>
                <div class="stat-label">Active Members</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">📊</div>
                <div class="stat-number">∞</div>
                <div class="stat-label">Possibilities</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">🎯</div>
                <div class="stat-number">100%</div>
                <div class="stat-label">Success Rate</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">🏆</div>
                <div class="stat-number">2025</div>
                <div class="stat-label">Established</div>
            </div>
        </section>

        <div class="form-container">
            <div class="form-header">
                <div class="form-icon">∫ f(x) dx</div>
                <h2 class="form-title">Join Our Mathematical Journey</h2>
                <p class="form-subtitle">Begin your transformation into a mathematical and AI pioneer. Every great equation starts with a single variable.</p>
            </div>

            <form id="registrationForm" class="registration-form">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="fullName">
                            Full Name <span class="required">*</span>
                        </label>
                        <input type="text" id="fullName" name="fullName" placeholder="Enter your complete name" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="email">
                            Email Address <span class="required">*</span>
                        </label>
                        <input type="email" id="email" name="email" placeholder="your.email@domain.com" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="phone">
                            Phone Number <span class="required">*</span>
                        </label>
                        <input type="tel" id="phone" name="phone" placeholder="+92 300 1234567" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="studentId">
                            Roll Number <span class="required">*</span>
                        </label>
                        <input type="text" id="studentId" name="studentId" placeholder="Your university roll number" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="department">
                            Department <span class="required">*</span>
                        </label>
                        <select id="department" name="department" required>
                            <option value="">Select Your Department</option>
                            <option value="Computer Science">Computer Science</option>
                            <option value="Software Engineering">Software Engineering</option>
                            <option value="Mathematics">Mathematics</option>
                            <option value="Media">Media Studies</option>
                            <option value="Artificial Intelligence">Artificial Intelligence</option>
                            <option value="Physics">Physics</option>
                            <option value="Other">Other Field</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="year">
                            Academic Semester <span class="required">*</span>
                        </label>
                        <select id="year" name="year" required>
                            <option value="">Select Your Semester</option>
                            <option value="FA-25">FA-25</option>
                            <option value="SP-25">SP-25</option>
                            <option value="FA-24">FA-24</option>
                            <option value="SP-24">SP-24</option>
                            <option value="FA-23">FA-23</option>
                            <option value="SP-23">SP-23</option>
                            <option value="FA-22">FA-22</option>
                            <option value="SP-22">SP-22</option>
                            <option value="other">other</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group full-width">
                    <label for="interests">
                        Mathematical Interests & Research Goals
                    </label>
                    <textarea id="interests" name="interests" placeholder="Share your passion for mathematics and AI. What mathematical concepts fascinate you? What research areas do you want to explore? How do you see yourself contributing to the field of AI and Mathematics?"></textarea>
                </div>

                <div class="submit-section">
                    <button type="submit" class="submit-btn" id="submitBtn">
                        Join AIMS Society
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Welcome Modal -->
    <div id="welcomeModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeWelcomeModal()">&times;</span>
            <img src="images/logo.png" alt="AIMS Logo" class="modal-logo">
            <h2>Welcome to AIMS Mathematical Universe!</h2>
            <p><strong>Artificial Intelligence & Mathematics Society</strong></p>
            <p>Welcome to Lahore Garrison University community for Artificial Intelligence and Mathematics enthusiasts. Join us in pushing the boundaries of technology and mathematical excellence.</p>
            <div class="modal-equation">
                <span>Success = ∫(Passion + Knowledge + Innovation)dx</span>
            </div>
            <button class="modal-btn" onclick="closeWelcomeModal()">Begin Your Journey</button>
        </div>
    </div>

    <!-- Success Modal -->
    <div id="successModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeSuccessModal()">&times;</span>
            <div class="modal-math-symbol">√</div>
            <h2>Registration Successful!</h2>
            <p>Congratulations! You have successfully joined the <strong>AIMS Society</strong>.</p>
            <p>Your registration details have been saved and you'll receive further information soon. Welcome to our mathematical community!</p>
            <div class="modal-equation success">
                <span>You ∈ AIMS Community ✓</span>
            </div>
            <button class="modal-btn" onclick="window.open('https://www.instagram.com/aims_lgu', '_blank'); closeSuccessModal();">Continue Your Journey</button>
        </div>
    </div>

    <script>
        // Configuration
        const GOOGLE_SHEETS_URL = 'https://script.google.com/macros/s/AKfycbyjikwbx-wLLY6xe7mh7ddPFKksQndGjRgP5WN9Ivcti5zyQ-d9lDbgY63-uuwIRX8n/exec';
        
        let studentsDatabase = [];
        let totalMembers = 11;

        // Modal Functions - COMPLETELY REWRITTEN
        function showWelcomeModal() {
            const modal = document.getElementById('welcomeModal');
            if (modal) {
                modal.style.display = 'block';
                console.log('Welcome modal shown');
            }
        }

        function closeWelcomeModal() {
            const modal = document.getElementById('welcomeModal');
            if (modal) {
                modal.style.display = 'none';
                console.log('Welcome modal closed');
            }
        }

        function showSuccessModal() {
            const modal = document.getElementById('successModal');
            if (modal) {
                modal.style.display = 'block';
                console.log('Success modal shown');
            }
        }

        function closeSuccessModal() {
            const modal = document.getElementById('successModal');
            if (modal) {
                modal.style.display = 'none';
                console.log('Success modal closed');
            }
        }

        // Google Sheets Integration
        async function sendToGoogleSheets(studentData) {
    console.log('Sending data to Google Sheets...', studentData);

    // Convert studentData to URL-encoded string
    const formBody = Object.keys(studentData)
        .map(key => encodeURIComponent(key) + '=' + encodeURIComponent(studentData[key]))
        .join('&');

    try {
        const response = await fetch(GOOGLE_SHEETS_URL, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: formBody
        });

        console.log('Response status:', response.status);

        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        const responseText = await response.text();
        console.log('Raw response:', responseText);

        let result;
        try {
            result = JSON.parse(responseText);
        } catch (parseError) {
            console.error('Failed to parse JSON:', parseError);
            throw new Error('Invalid JSON response');
        }

        console.log('Success:', result);

        // Save locally as backup
        studentsDatabase.push(studentData);
        localStorage.setItem('aimsStudents', JSON.stringify(studentsDatabase));

        return result;

    } catch (error) {
        console.error('Error:', error);

        // Save locally as fallback
        studentsDatabase.push(studentData);
        localStorage.setItem('aimsStudents', JSON.stringify(studentsDatabase));

        alert(`Backend Error: ${error.message}\nData saved locally.`);
        return { success: false, error: error.message };
    }
}

        // Form handling
        function generateStudentId() {
            const timestamp = Date.now().toString();
            const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
            return 'AIMS' + timestamp.slice(-6) + random.slice(-2);
        }

        function validateForm() {
            const requiredFields = document.querySelectorAll('[required]');
            let isValid = true;

            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    isValid = false;
                    field.style.borderColor = '#dc2626';
                } else {
                    field.style.borderColor = '#10b981';
                }
            });

            return isValid;
        }

        function formatPhoneNumber(phoneInput) {
            let value = phoneInput.value.replace(/\D/g, '');
            
            if (value.startsWith('92')) {
                value = '+' + value;
            } else if (value.startsWith('0')) {
                value = '+92' + value.substring(1);
            } else if (value.startsWith('3')) {
                value = '+92' + value;
            }
            
            phoneInput.value = value;
        }

        function validateEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        async function processRegistration() {
            try {
                showLoading(true);
                
                const formData = new FormData(document.getElementById('registrationForm'));
                
                const studentRecord = {
                    id: generateStudentId(),
                    timestamp: new Date().toISOString(),
                    registrationDate: new Date().toLocaleDateString('en-US', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    }),
                    registrationTime: new Date().toLocaleTimeString('en-US'),
                    fullName: formData.get('fullName').trim(),
                    email: formData.get('email').trim().toLowerCase(),
                    phone: formData.get('phone').trim(),
                    studentId: formData.get('studentId').trim(),
                    department: formData.get('department'),
                    academicYear: formData.get('year'),
                    interests: formData.get('interests').trim() || 'Not specified',
                    status: 'Active',
                    source: 'AIMS Website Registration - LGU'
                };

                if (!validateEmail(studentRecord.email)) {
                    throw new Error('Please enter a valid email address');
                }

                await sendToGoogleSheets(studentRecord);
                
                totalMembers++;
                updateMemberCount();
                
                showSuccessModal();
                
                setTimeout(() => {
                    resetForm();
                }, 1000);
                
            } catch (error) {
                console.error('Registration failed:', error);
                alert(`Registration failed: ${error.message}`);
            } finally {
                showLoading(false);
            }
        }

        function showLoading(show) {
            const submitBtn = document.getElementById('submitBtn');
            
            if (show) {
                submitBtn.disabled = true;
                submitBtn.classList.add('loading');
            } else {
                submitBtn.disabled = false;
                submitBtn.classList.remove('loading');
            }
        }

        function resetForm() {
            document.getElementById('registrationForm').reset();
            const inputs = document.querySelectorAll('input, select, textarea');
            inputs.forEach(input => {
                input.style.borderColor = '#e0e7ff';
            });
        }

        function updateMemberCount() {
            const memberElement = document.getElementById('totalStudents');
            if (memberElement) {
                memberElement.textContent = totalMembers;
            }
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, setting up event listeners...');
            
            // Form submission
            const form = document.getElementById('registrationForm');
            if (form) {
                form.addEventListener('submit', function(e) {
                    e.preventDefault();
                    if (validateForm()) {
                        processRegistration();
                    }
                });
            }

            // Phone formatting
            const phoneInput = document.getElementById('phone');
            if (phoneInput) {
                phoneInput.addEventListener('input', function() {
                    formatPhoneNumber(this);
                });
            }

            // Email validation
            const emailInput = document.getElementById('email');
            if (emailInput) {
                emailInput.addEventListener('blur', function() {
                    if (this.value && !validateEmail(this.value)) {
                        this.style.borderColor = '#dc2626';
                    }
                });
            }

            // Modal close on background click
            window.addEventListener('click', function(event) {
                const welcomeModal = document.getElementById('welcomeModal');
                const successModal = document.getElementById('successModal');
                
                if (event.target === welcomeModal) {
                    closeWelcomeModal();
                }
                if (event.target === successModal) {
                    closeSuccessModal();
                }
            });

            // Show welcome modal after page loads
            setTimeout(() => {
                showWelcomeModal();
            }, 1500);
        });

        // Initialize app
        function initializeApp() {
            console.log('AIMS LGU System initializing...');
            
            // Load saved data
            const savedData = localStorage.getItem('aimsStudents');
            if (savedData) {
                studentsDatabase = JSON.parse(savedData);
                totalMembers = Math.max(totalMembers, studentsDatabase.length);
            }
            
            updateMemberCount();
            console.log('AIMS System ready!');
        }

        // Debug functions
        window.AIMS_DEBUG = {
            showWelcome: showWelcomeModal,
            showSuccess: showSuccessModal,
            closeWelcome: closeWelcomeModal,
            closeSuccess: closeSuccessModal,
            testBackend: () => sendToGoogleSheets({test: true, timestamp: new Date().toISOString()}),
            checkData: () => console.log('Local data:', JSON.parse(localStorage.getItem('aimsStudents') || '[]'))
        };

        // Initialize when page loads
        window.addEventListener('load', initializeApp);
    </script>
</body>
</html>